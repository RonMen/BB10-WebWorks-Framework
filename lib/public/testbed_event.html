<html>
    <head>
        <script type="text/javascript" src="require.js"></script>
        <script type="text/javascript" src="webworks.js"></script>
        <script type="text/javascript">
            var callbackIds = [],
                intervalId,
                success = function (data, response) {
                    console.log("success callback: " + data);
                    intervalId = data;
                };

            function startListen() {
                var id = blackberry.example.event.startListen(createCallback());
                console.log("start listen, id=" + id);
                callbackIds.push(id);
            }

            function stopListen() {
                var id;
                callbackIds.reduce(function (prev, current) {
                    if (prev === undefined) {
                        id = current;
                    }

                    return id;
                }, id);

                if (id !== undefined) {
                    delete callbackIds[id];
                    console.log("stop listen, id=" + id);
                    blackberry.example.event.stopListen(id);
                } else {
                    console.log("No callbacks registered for event");
                }
            }

            function startEvent() {
                webworks.exec(success, null, "blackberry.example.event", "startEvent", null, false);
            }

            function stopEvent() {
                webworks.exec(success, null, "blackberry.example.event", "stopEvent", { "intervalId": intervalId }, false);
            }

            function createCallback() {
                var callbackId = callbackIds.length;
                return function (data) {
                    console.log("Callback " + callbackId + " invoked! Data=" + data);
                };
            }
        </script>
    </head>
    <body>
        <div>This is a testbed for events!</div>
        <input type="button" onclick="startEvent()" value="Start Event"><br>
        <input type="button" onclick="stopEvent()" value="Stop Event"><br>
        <input type="button" onclick="startListen()" value="Start Listen"><br>
        <input type="button" onclick="stopListen()" value="Stop Listen"><br>
    </body>
</html>